// Generated by CoffeeScript 1.3.1

window.ResultsView = Backbone.View.extend({
  initialize: function() {
    return this.template = _.template(tpl.get('results'));
  },
  events: {
    "click .back": "back"
  },
  render: function() {
    $(this.el).html(this.template());
    if (!this.model) {
      this.updateModel();
    } else {
      this.generateList();
    }
    return this;
  },
  updateParams: function() {
    var time, timetype;
    this.params = {
      from: getUrlParam("from"),
      to: getUrlParam("to")
    };
    time = getUrlParam("time");
    timetype = getUrlParam("timetype");
    if (time) {
      this.params.time = time;
    }
    if (timetype) {
      return this.params.timetype = timetype;
    }
  },
  updateModel: function() {
    var _this = this;
    $(this.el).find("#routelist").html("");
    $(this.el).find("#loader").css("display", "block");
    this.updateParams();
    return Reittiopas.route(this.params, function(results) {
      _this.model = results;
      $(_this.el).find("#loader").hide();
      return _this.generateList();
    });
  },
  generateList: function() {
    var routelist,
      _this = this;
    routelist = $(this.el).find("#routelist");
    _.each(this.model, function(result) {
      var item;
      item = new ResultsViewItem({
        model: result[0]
      }).render().el;
      return routelist.append(item);
    });
    return routelist.listview('refresh');
  }
});

window.ResultsViewItem = Backbone.View.extend({
  tagName: "li",
  events: {
    "click a": "showRoute"
  },
  showRoute: function() {
    app.navigate("#showRoute");
    return app.resultMap(this.model);
  },
  initialize: function() {
    return this.template = _.template(tpl.get('result-item'));
  },
  render: function() {
    $(this.el).html(this.template({
      route: this.model
    }));
    return this;
  }
});
